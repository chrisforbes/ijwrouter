<html>
	<head>
		<title>Your Internet Usage</title>
		<link type="text/css" rel="Stylesheet" href="main.css" />
		<style>
			#bar { border: 2px solid black; margin: 1em; margin-top: 0; height: 28px }
			#barfill { background-color: #48b4eb; border: 0px; margin: 0px; height: 28px; width: 0% }
		</style>
		<script src="jquery-1.2.3.min.js"></script>
		<script>
		<!--
			var dialogs;
			var current_dialog = null;
			
			function show_dialog( e )
			{
				dialogs.not( e ).hide();
				e.show();
				
				var w = window.innerWidth;
				var h = window.innerHeight;
				
				if (w == null) w = document.body.clientWidth;
				if (h == null) h = document.body.clientHeight;
				
				e.css("left", (w - e.width()) / 2);
				e.css("top", (h - e.height()) / 2);
				
				current_dialog = e;
			}
					
			function do_ajax()
			{
				$.ajax({
				type: "GET",
				url: "query/usage",
				timeout: 4000,
				success: function(data)
				{
					show_dialog( $("#foo") );
					if (data != "{}")
						merge_data( eval( "(" + data + ")" ) );
				},
				error: function(xhr, status, e)
				{
					show_dialog( $("#error") );
				},
				complete: function() { setTimeout( "do_ajax()", 2000 ); }
				});
			}
			
			function merge_data( d )
			{
				for( var k in d ) $( "#" + k ).html(d[k]);
				$("#barfill").css("width", d.fill + "%");
			}
			
			$(function()
			{ 
				dialogs = $("#foo, #error, #wait");
				
				show_dialog( $("#wait") );
				do_ajax(); 
				window.onresize = function() { show_dialog( current_dialog ); };
			});
		//-->
		</script>
	</head>
	<body>
		<div id="foo" style="width: 600px; height: 320px; display: none">
		<h1>Welcome, <span id="uname" class="field">---</span>!</h1>
				<h2> Since <span id="start" class="field">---</span>, you've used<br/>
				<span id="current" class="field">---</span> 
					of your <span id="quota" class="field">---</span> quota.
				<br/>(<span id="days" class="field">---</span> days remaining)</h2>
			<table width="100%"><tr><td id="bar">
				<div id="barfill"></div>
			</td></tr></table>
			<form action="name" method="get" style="text-align: center">
				<p><label>Change the name associated with your account:</label></p>
				<p><input name="name"><button type="submit">Submit</button></p>
			</form>
		</div>
		<div id="error" style="width: 650px; height: 80px; display: none">
			<h2>We're having trouble retrieving data from the router.</h2>
		</div>
		<div id="wait" style="width: 650px; height: 80px; display: none">
			<h2>Downloading usage data...</h2>
		</div>
	</body>
</html>
