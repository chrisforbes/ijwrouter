<html>
	<head>
		<title>Your Internet Usage</title>
		<link type="text/css" rel="Stylesheet" href="main.css" />
		<style>
			#bar { border: 2px solid black; margin: 1em; margin-top: 0; height: 28px }
			#barfill { background-color: #48b4eb; border: 0px; margin: 0px; height: 28px; width: 0% }
		</style>
		<script src="jquery-1.2.3.min.js"></script>
		<script>
		<!--
			var size_installed = false;
			
			function do_element_size( e, layout )
			{
				e.style.position = "absolute";
				e.style.left = ( layout.frameWidth - layout.objectWidth ) / 2;
				e.style.width = layout.objectWidth;
				e.style.top = ( layout.frameHeight - layout.objectHeight ) / 2;
				e.style.height = layout.objectHeight;
			}
			
			function do_size()
			{
				if (!size_installed)
					window.onresize = do_size;
					
				var w = window.innerWidth;
				var h = window.innerHeight;
				
				if (w == null) w = document.body.clientWidth;
				if (h == null) h = document.body.clientHeight;
				
				do_element_size( $("#foo").get(0), { frameWidth: w, frameHeight: h, objectWidth: 600, objectHeight: 320 } );
				do_element_size( $("#error").get(0), { frameWidth: w, frameHeight: h, objectWidth: 650, objectHeight: 80 } );
			}
			
			function do_ajax()
			{
				$.ajax({
				type: "GET",
				url: "query/usage",
				timeout: 2000,
				success: function(data)
				{
					if (data != "{}")
						merge_data( eval( "(" + data + ")" ) );
					setTimeout( "do_ajax()", 2000 );
					
					$("#foo").css("display", "block");
					$("#error").css("display", "none");
					do_size();
				},
				error: function(xhr, status, e)
				{
					$("#foo").css("display", "none");
					$("#error").css("display", "block");
					do_size();
					setTimeout( "do_ajax()", 2000 );
				}
				});
			}
			
			function merge_data( d )
			{
				for( var k in d )
					$( "#" + k ).html(d[k]);
				
				$("#barfill").css("width", d.fill + "%");
			}
			
			$(function(){ do_size(); do_ajax(); });
		//-->
		</script>
	</head>
	<body>
		<div id="foo">
		<h1>Welcome, <span id="uname" class="field">---</span>!</h1>
				<h2> Since <span id="start" class="field">---</span>, you've used<br/>
				<span id="current" class="field">---</span> 
					of your <span id="quota" class="field">---</span> quota.
				<br/>(<span id="days" class="field">---</span> days remaining)</h2>
			<table width="100%"><tr><td id="bar">
				<div id="barfill"></div>
			</td></tr></table>
			<form action="name" method="get" style="text-align: center">
				<p><label>Change the name associated with your account:</label></p>
				<p><input name="name"><button type="submit">Submit</button></p>
			</form>
		</div>
		<div id="error">
			<h2>We're having trouble retrieving data from the router.</h2>
		</div>
	</body>
</html>
